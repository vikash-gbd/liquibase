name: Deploy to Snowflake

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Liquibase Update (dry-run or actual)
        uses: liquibase-github-actions/update@v4.33.0
        with:
          operation: ${{ github.run_number == 1 && 'updateSQL' || 'update' }}
          changelogFile: 'changelog/liquibase-master.xml'
          classpath: '.'  # include all SQL changelogs
          url: ${{ secrets.SF_URL }}
          username: ${{ secrets.SF_USER }}
          password: ${{ secrets.SF_PASSWORD }}
          defaultSchemaName: ${{ secrets.SF_SCHEMA }}
          defaultCatalogName: ${{ secrets.SF_DATABASE }}
          driver: 'net.snowflake.client.jdbc.SnowflakeDriver'
          logLevel: INFO
        env:
          LIQUIBASE_HOME: /github/home/.liquibase
